(self["webpackChunk_N_E"]=self["webpackChunk_N_E"]||[]).push([[905],{2277:function(n,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/bond",function(){return r(4903)}]);if(false);},4903:function(n,e,r){"use strict";r.r(e);r.d(e,{default:function(){return D}});var o=r(7568);var t=r(4924);var a=r(6042);var c=r(828);var i=r(4051);var u=r.n(i);var d=r(5893);var l=r(6441);var s=r(762);var v=r(8528);var f=r(3280);var m=r(8067);var p=r(7564);var x=r(1232);var g=r(9236);var h=r(4459);var k=r(3723);var C=r(2623);var b=r(3520);var B=r(7294);var w=r(5117);var j=r(4685);var y=r(5574);var _=r(7319);function BondSummary(n){var e=n.bondLogs,r=n.bondConfigs,o=n.pokemonList;var t=(0,B.useMemo)((function(){var n=[];r.map((function(r){var t;var a=o.find((function(n){return n.uuid===r.pokemonUuid}));var c=a?"".concat(a.name||"(Unnamed)"," the ").concat(a.species||"(Unknown Pokemon)"):"ERR: Pokemon Missing!";var i=e.filter((function(n){return n.pokemon===r.pokemonUuid})).reduce((function(n,e){return Math.min(30,n+e.value)}),0);var u;var d=null!==(u=null===(t=e[e.length-1])||void 0===t?void 0:t.sourceUrl)&&void 0!==u?u:null;n.push({label:c,color:r.colorCode,iconImageLink:r.iconImageLink,bondTotal:i,bondLink:d})}));return n}),[e,r,o]);return(0,d.jsx)(C.X,{sx:{backgroundColor:"#252525",color:"#ccc"},children:(0,d.jsx)(h.x,{px:"1em",pt:"0.5em",sx:{display:"grid",gridAutoFlow:"row",gridAutoRows:"60px"},children:t?t.map((function(n){return(0,d.jsx)(BondSummaryRow,(0,a.Z)({},n),n.label)})):"No Pokemon"})})}function BondSummaryRow(n){var e=n.label,r=n.color,o=n.iconImageLink,t=n.bondTotal,a=n.bondLink;return(0,d.jsxs)(x.Z,{spacing:"0.25em",noWrap:true,children:[o&&(0,d.jsx)(y.z,{imageLink:o},"".concat(e,"-icon-image")),(0,d.jsx)(w.x,{sx:{color:r?r:void 0,whiteSpace:"nowrap"},children:e},"".concat(e,"-text")),(0,d.jsx)(w.x,{ml:"auto",children:(0,d.jsx)(_.SR,{wrapIf:!!a,wrap:function(n){return(0,d.jsx)(j.e,{href:a,children:n},"".concat(e,"-link"))},children:(0,d.jsx)(d.Fragment,{children:t})},"".concat(e,"-wrap-if"))})]},"".concat(e,"-group"))}var L=r(61);var Z=r(4777);function BondConfigEditor(n){var e=n.bondConfigs,r=n.onChange;var o=(0,B.useMemo)((function(){return e.map((function(n){return{bondConfig:n,onChange:function(e,o){return r(n,e,o)}}}))}),[e,r]);return(0,d.jsx)(h.x,{px:"1em",sx:{width:"max-content",display:"grid",gridAutoFlow:"row",gridAutoRows:"60px"},children:o.map((function(n,e){return(0,d.jsx)(BondConfigEditorRow,(0,a.Z)({},n),e)}))})}var U=[["colorCode","Color Code"],["iconImageLink","Icon Image Link"],["preHeaderBBCode","Pre-Header BBCode"],["postHeaderBBCode","Post-Header BBCode"],["preFooterBBCode","Pre-Footer BBCode"],["postFooterBBCode","Post-Footer BBCode"]];function BondConfigEditorRow(n){var e=n.bondConfig,r=n.onChange;var o={};var t=true,a=false,i=void 0;try{for(var u=U[Symbol.iterator](),l;!(t=(l=u.next()).done);t=true){var s=(0,c.Z)(l.value,2),v=s[0],f=s[1];var m;o[v]=(0,B.useState)(null!==(m=e[v])&&void 0!==m?m:"")}}catch(g){a=true;i=g}finally{try{if(!t&&null!=u.return)u.return()}finally{if(a)throw i}}return(0,d.jsx)(p.K,{spacing:0,children:(0,d.jsx)(x.Z,{spacing:"0.5em",children:U.map((function(n,e){var t=(0,c.Z)(n,2),a=t[0],i=t[1];return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(L.o,{size:"xs",my:0,label:i,value:o[a][0],onChange:function(n){var e=n.currentTarget.value;o[a][1](e);r(a,e)}},a),1===e&&(0,d.jsx)(Z.i,{orientation:"vertical"},"divider")]})}))})})}var S=r(55);var E=r(7484);var M=r.n(E);var P=r(178);var I=r.n(P);var R=r(1839);var O=r(9815);function BondBbCodeOutput(n){var e=n.bondLogs,r=n.bondConfigs,o=n.pokemonList;var a;var c=(0,B.useMemo)((function(){return(a=Object).assign.apply(a,[{}].concat((0,O.Z)(o.map((function(n){return(0,t.Z)({},n.uuid,"".concat(n.name||"(Unnamed)"," the ").concat(n.species||"(Unknown Pokemon)"))})))))}),[o]);var i=(0,B.useMemo)((function(){var n=r.map((function(n){var r=[];var o=[];e.filter((function(e){return e.pokemon===n.pokemonUuid})).forEach((function(n){if(n.verifiedInShopUpdate)r.push(n);else o.push(n)}));if(0===o.length)return null;var t=c[n.pokemonUuid];var a=r.reduce((function(n,e){return Math.min(30,n+e.value)}),0);var i=o.reduce((function(n,e){return Math.min(30,n+e.value)}),a);var u=r.length>0?r.reduce((function(n,e){return e.date.valueOf()>=n.date.valueOf()?e:n})).sourceUrl:null;var d=o.map((function(n){return"".concat(n.sourceUrl?"[url=".concat(n.sourceUrl,"]"):"").concat(n.value>0?"+":"").concat(n.value," - ").concat(n.sourceNote," (").concat(n.date.format("DD-MMM-YYYY"),")").concat(n.sourceUrl?"[/url]":"","\n")}));var l,s,v,f;return"".concat(n.colorCode?"[color=".concat(n.colorCode,"]"):"").concat(null!==(l=n.preHeaderBBCode)&&void 0!==l?l:"").concat(t).concat(n.iconImageLink?"[img]".concat(n.iconImageLink,"[/img]"):"","\nStarting Bond: ").concat(u?"[url=".concat(u,"]"):"").concat(a).concat(u?"[/url]":"").concat(null!==(s=n.postHeaderBBCode)&&void 0!==s?s:"","\n").concat(d.join("")).concat(null!==(v=n.preFooterBBCode)&&void 0!==v?v:"","Ending Bond: [B]").concat(i,"[/B]").concat(null!==(f=n.postFooterBBCode)&&void 0!==f?f:"").concat(n.colorCode?"[/color]":"")}));return"[size=1]".concat(n.filter((function(n){return!!n})).join("\n\n")||"","[/size]")}),[r,e,c]);return(0,d.jsx)(b.Gp,{label:"Bond Output",bbCode:i})}M().extend(I());var F=(0,m.k)({pokemon:{minWidth:"10em"},sourceUrl:{maxWidth:"15em"}});var BondPage=function(){var n=(0,c.Z)((0,l.MK)(s.xY,s.y1,s.bz),3),e=n[0],r=n[1],i=n[2];var m=(0,c.Z)((0,v.n)([]),2),w=m[0],j=m[1];var y=(0,c.Z)((0,v.n)([]),2),_=y[0],L=y[1];var Z=(0,c.Z)((0,v.n)([]),2),U=Z[0],E=Z[1];(0,f.useAsyncEffect)((0,o.Z)(u().mark((function _callee(){var n,o,t;return u().wrap((function _callee$(a){while(1)switch(a.prev=a.next){case 0:if(!(!e||!r||!i)){a.next=2;break}return a.abrupt("return");case 2:a.next=4;return(0,l.Wz)(r);case 4:a.t0=j;a.next=7;return r.find({loadEagerRelations:false,loadRelationIds:true});case 7:a.t1=a.sent;a.t0.setState.call(a.t0,a.t1);a.next=11;return(0,l.Wz)(i);case 11:a.next=13;return i.find({select:["uuid","name","species"],loadEagerRelations:false});case 13:n=a.sent;E.setState(n);a.next=17;return(0,l.Wz)(e);case 17:a.next=19;return e.find();case 19:o=a.sent;t=n.filter((function(n){return o.every((function(e){return e.pokemonUuid!==n.uuid}))})).map((function(n){return e.create({pokemonUuid:n.uuid})}));L.setState(o.concat(t));case 22:case"end":return a.stop()}}),_callee)}))),[e,i]);var P=(0,B.useState)(false),I=P[0],O=P[1];var D=(0,l.Dd)(e);var z=(0,B.useCallback)((function(n,e,r){var o=_.indexOf(n);L.setItemProp(o,e,r);D(n,(0,t.Z)({},e,r))}),[D,_]);var T=(0,B.useMemo)((function(){return{value:(0,S.cL)("value","Change",0),pokemon:(0,S.jB)(U.map((function(n){return{value:n.uuid,label:"".concat(n.name||"(Unnamed)"," the ").concat(n.species||"(Unknown Pokemon)")}})),"pokemon","Pokemon",1)}}),[U]);var A=(0,l.Dd)(r);var H=(0,B.useMemo)((function(){return{rowObjToId:function(n){return n.pokemon},propConfig:T,add:(0,o.Z)(u().mark((function _callee(){return u().wrap((function _callee$(n){while(1)switch(n.prev=n.next){case 0:n.t0=j;n.next=3;return r.save(r.create({value:0,pokemon:U[0].uuid,date:M()().utc()}));case 3:n.t1=n.sent;n.t0.append.call(n.t0,n.t1);case 5:case"end":return n.stop()}}),_callee)}))),edit:function(){var n=(0,o.Z)(u().mark((function _callee(n,e,r){var o;return u().wrap((function _callee$(a){while(1)switch(a.prev=a.next){case 0:o=w.indexOf(n);j.setItemProp(o,e,r);A(n,(0,t.Z)({},e,r));case 3:case"end":return a.stop()}}),_callee)})));return function(e,r,o){return n.apply(this,arguments)}}(),remove:function(){var n=(0,o.Z)(u().mark((function _callee(n){return u().wrap((function _callee$(e){while(1)switch(e.prev=e.next){case 0:j.filter((function(e){return e.id!==n.id}));e.next=3;return r.remove(n);case 3:case"end":return e.stop()}}),_callee)})));return function(e){return n.apply(this,arguments)}}()}}),[w,r,T,U,A]);var N=F();if(!e||!r||!i)return(0,d.jsx)(d.Fragment,{children:"Loading..."});return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(p.K,{children:[(0,d.jsxs)(x.Z,{sx:{alignContent:"center"},children:[(0,d.jsx)(g.D,{order:2,sx:{width:"50%",textAlign:"right",marginRight:"auto"},children:"Bond"}),(0,d.jsx)(b.wP,{checked:I,onToggle:O})]}),(0,d.jsxs)(h.x,{sx:{display:"grid",gridTemplateColumns:"20em 1fr"},children:[(0,d.jsx)(g.D,{order:3,mb:"0.5em",children:"Summary"}),(0,d.jsx)(g.D,{order:3,mb:"0.5em",children:"Bond Styling"}),(0,d.jsx)(BondSummary,{bondLogs:w,bondConfigs:_,pokemonList:U}),(0,d.jsx)(k.x,{type:"auto",sx:function(n){return{backgroundColor:n.colors.dark[8]}},children:(0,d.jsx)(BondConfigEditor,{bondConfigs:_,onChange:z})})]}),(0,d.jsx)(g.D,{order:3,children:"Detail"}),(0,d.jsx)(C.X,{sx:function(n){return{margin:"0.5em",borderRadius:"0.5em",border:"1px solid "+n.colors.gray[7],backgroundColor:n.fn.darken(n.colors.gray[9],.2),overflow:"clip"}},children:(0,d.jsx)(k.x.Autosize,{maxHeight:"40vh",children:(0,d.jsx)(R.Q,(0,a.Z)({rowObjs:w,isShopLog:true,isEditMode:I,propsToMantineClasses:N.classes},H))})}),(0,d.jsx)(g.D,{order:3,children:"Output"}),(0,d.jsx)(BondBbCodeOutput,{bondLogs:w,bondConfigs:_,pokemonList:U})]})})};var D=BondPage}},function(n){var __webpack_exec__=function(e){return n(n.s=e)};n.O(0,[774,888,179],(function(){return __webpack_exec__(2277)}));var e=n.O();_N_E=e}]);