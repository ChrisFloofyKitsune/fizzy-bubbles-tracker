(self["webpackChunk_N_E"]=self["webpackChunk_N_E"]||[]).push([[689],{8473:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/items",function(){return t(1636)}]);if(false);},1636:function(e,n,t){"use strict";t.r(n);t.d(n,{default:function(){return R}});var r=t(7568);var a=t(4924);var i=t(6042);var o=t(9396);var c=t(828);var l=t(9815);var u=t(4051);var s=t.n(u);var d=t(5893);var v=t(8067);var f=t(5117);var m=t(1232);var p=t(9834);var h=t(9236);var x=t(7564);var g=t(7841);var y=t(6222);var b=t(3723);var j=t(6441);var k=t(7294);var w=t(762);var C=t(8528);var I=t(3280);var D=t(3520);var _=t(7319);var L=t(7106);var Z=t(3602);var z=t(5266);var M=t(2753);var U=t(7276);var W=t(579);var E=t(4459);var O=t(7789);var q=t(9094);var S=t(4480);function InventoryCurrent(e){var n=e.categories,t=e.categoryIcons,a=e.data,i=e.isEditMode,o=e.onEditClick,c=e.onConfirmedDelete;var l=(0,k.useState)(n[0]),u=l[0],v=l[1];var g=(0,k.useMemo)((function(){return u&&a[u]||null}),[a,u]);return(0,d.jsxs)(W.m,{orientation:"vertical",variant:"outline",radius:"xl",value:u,onTabChange:function(e){return v(null!==e&&void 0!==e?e:n[0])},styles:function(e){return{tab:{"&[data-active]":{backgroundColor:e.colors.dark[6],"::before":{backgroundColor:e.colors.dark[6]}}},panel:{backgroundColor:e.colors.dark[7],border:"1px solid"+e.colors.dark[4],borderLeft:"none"}}},children:[(0,d.jsx)(W.m.List,{children:Object.keys(a).map((function(e){return(0,d.jsx)(W.m.Tab,{value:e,children:(0,d.jsx)(S.b,{category:e,categoryIcons:t},"tab-label-".concat(e))},"tab-".concat(e))}))}),(0,d.jsx)(E.x,{sx:function(e){return{width:"100%",border:"1px solid"+e.colors.dark[4],borderLeft:"none",zIndex:0}},children:(0,d.jsx)(x.K,{spacing:"0",sx:function(e){return{">.mantine-Group-root":{padding:"0.1em 0.5em"},">:nth-of-type(2n)":{backgroundColor:e.colors.dark[6]}}},children:g&&Object.values(g).map((function(e){return(0,d.jsxs)(m.Z,{position:"apart",noWrap:true,children:[(0,d.jsx)(U.w,{data:e},"inv-line-".concat(u,"-").concat(e.itemDefId)),i&&(0,d.jsxs)(m.Z,{noWrap:true,children:[(0,d.jsx)(p.A,{variant:"default",onClick:function(){return null===o||void 0===o?void 0:o(e.itemDefId)},children:(0,d.jsx)(M.dY,{})}),(0,d.jsx)(p.A,{variant:"filled",color:"red",onClick:function(){return(0,z._5)({title:(0,d.jsx)(O.C,{color:"red",size:"xl",sx:{height:"4em"},children:(0,d.jsx)(h.D,{children:"Confirm Item Deletion"})}),children:(0,d.jsx)(q.M,{children:(0,d.jsx)(f.x,{size:"xl",weight:"bold",children:"Deletion cannot be undone!"})}),withCloseButton:false,styles:{modal:{width:"min-content"}},centered:true,labels:{cancel:"Cancel",confirm:"DELETE"},groupProps:{position:"center"},cancelProps:{size:"lg",variant:"outline",color:"yellow"},confirmProps:{size:"lg",color:"red"},onConfirm:(0,r.Z)(s().mark((function _callee(){return s().wrap((function _callee$(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return null===c||void 0===c?void 0:c(e.itemDefId);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),_callee)})))})},children:(0,d.jsx)(M.pJ,{})})]},"inv-buttons-".concat(u,"-").concat(e.itemDefId))]},"inv-group-".concat(u,"-").concat(e.itemDefId))}))})})]})}var $=t(3854);var A=t(1839);var N=t(5574);var P=t(8348);function InventoryBBCodeOutput(e){var n=e.data;var t=(0,k.useMemo)((function(){return Object.keys(n)}),[n]);var r=(0,k.useMemo)((function(){var e={};var r=true,a=false,i=void 0;try{for(var o=t[Symbol.iterator](),c;!(r=(c=o.next()).done);r=true){var l=c.value;var u=[];var s=true,d=false,v=void 0;try{for(var f=Object.values(n[l])[Symbol.iterator](),m;!(s=(m=f.next()).done);s=true){var p=m.value;var h,x;var g=1===(null===(h=p.quantityChanges)||void 0===h?void 0:h.length);var y="- ".concat(!g||p.quantity>1?"x".concat(p.quantity," "):"").concat(g?"[URL=".concat(null===(x=p.quantityChanges)||void 0===x?void 0:x[0].link,"]"):"").concat(p.name).concat(g?"[/URL]":"");if(!g){var b;y+=" (".concat(null===(b=p.quantityChanges)||void 0===b?void 0:b.map((function(e){return"".concat(e.link?"[URL=".concat(e.link,"]"):"").concat(e.change>0?"+":"").concat(e.change).concat(e.link?"[/URL]":"")})).join(", "),")")}if(p.imageLink||p.description)y+=":".concat(p.imageLink?" [IMG]".concat(p.imageLink,"[/IMG]"):"").concat(p.description?" ".concat(p.description):"");u.push(y)}}catch(j){d=true;v=j}finally{try{if(!s&&null!=f.return)f.return()}finally{if(d)throw v}}e[l]=u}}catch(j){a=true;i=j}finally{try{if(!r&&null!=o.return)o.return()}finally{if(a)throw i}}return e}),[t,n]);var a=(0,k.useMemo)((function(){return Object.entries(r).map((function(e){var n=(0,c.Z)(e,2),t=n[0],r=n[1];return["[B]".concat(t,"[/B]:\n")].concat("Depleted"===t?"[spoiler]":"",r.join("\n"),"Depleted"===t?"[/spoiler]":"").filter((function(e){return!!e})).join("")})).join("\n\n")}),[r]);return(0,d.jsx)(D.Gp,{label:"Inventory",bbCode:a})}var T=t(55);var Y={"^depleted$":L.tjc,"^uncategorized$":$.cLc,"key|unique":L.BS5,ball:L.IZ$,medic:L.ppG,held:L.yE4,"battle|combat":L.g$9,"stuffed animal|doll|plush":L.Fwl,"ingredient|cook":L.$il,berr:L.UO$,"treasure|valuable":L.ab0,"tm|tr|hm|move":L.CVm,item:L.AV2,".":L.CSz};var B=(0,v.k)({quantityChange:{width:"5em"},itemDefinitionId:{minWidth:"10em",maxWidth:"15em"},sourceUrl:{maxWidth:"12em"},name:{minWidth:"8em",maxWidth:"12em"},category:{minWidth:"8em",maxWidth:"10em"},imageLink:{minWidth:"5em",maxWidth:"8em"},description:{minWidth:"min(50vw, 20em)"}});var ItemsPage=function(){var e=(0,c.Z)((0,j.MK)(w.Vh,w.kc),2),n=e[0],t=e[1];var u=(0,c.Z)((0,C.n)(),2),v=u[0],L=u[1];var W=(0,c.Z)((0,C.n)(),2),E=W[0],O=W[1];var q=(0,k.useState)(false),$=q[0],R=q[1];(0,I.useAsyncEffect)((0,r.Z)(s().mark((function _callee(){return s().wrap((function _callee$(e){while(1)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:e.next=4;return(0,j.Wz)(n);case 4:e.t0=L;e.next=7;return n.find();case 7:e.t1=e.sent;e.t0.setState.call(e.t0,e.t1);case 9:case"end":return e.stop()}}),_callee)}))),[n]);(0,I.useAsyncEffect)((0,r.Z)(s().mark((function _callee(){return s().wrap((function _callee$(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:e.next=4;return(0,j.Wz)(t);case 4:e.t0=O;e.next=7;return t.find();case 7:e.t1=e.sent;e.t0.setState.call(e.t0,e.t1);case 9:case"end":return e.stop()}}),_callee)}))),[t]);var G=(0,k.useMemo)((function(){if(0===E.length)return["Depleted","Uncategorized"];return E.filter((function(e){return!!e.category})).map((function(e){return e.category})).filter(_.el).concat("Depleted","Uncategorized")}),[E]);var K=(0,k.useMemo)((function(){var e;if(!G)return{};var n=G.map((function(e){var n;return(0,a.Z)({},e,null===(n=Object.entries(Y).find((function(n){return!!e.match(new RegExp(n[0],"i"))})))||void 0===n?void 0:n[1])}));return(e=Object).assign.apply(e,[{}].concat((0,l.Z)(n)))}),[G]);var V=(0,k.useMemo)((function(){if(!E)return null;var e={};var n=true,t=false,r=void 0;try{for(var a=E[Symbol.iterator](),i;!(n=(i=a.next()).done);n=true){var o=i.value;e[o.id]=o}}catch(c){t=true;r=c}finally{try{if(!n&&null!=a.return)a.return()}finally{if(t)throw r}}return e}),[E]);var F=(0,k.useMemo)((function(){if(!v||0===v.length||!V)return null;var e={};var n=true,t=false,r=void 0;try{for(var a=v.filter((function(e){return!!e.itemDefinitionId}))[Symbol.iterator](),i;!(n=(i=a.next()).done);n=true){var o=i.value;if(!o.itemDefinitionId)continue;var l=V[o.itemDefinitionId];if(!l)continue;var u=e[l.category||"Uncategorized"];if(!u)u=e[l.category||"Uncategorized"]={};var s=u[l.name];if(!s)u[l.name]={itemDefId:l.id,quantity:o.quantityChange,name:l.name,quantityChanges:[{change:o.quantityChange,link:o.sourceUrl,tooltipLabel:[o.sourceNote,"(".concat(o.date.format("DD-MMM-YYYY"),")")].join(" ")}],imageLink:l.imageLink,description:l.description};else{s.quantity+=o.quantityChange;s.quantityChanges.push({change:o.quantityChange,link:o.sourceUrl,tooltipLabel:[o.sourceNote,"(".concat(o.date.format("DD-MMM-YYYY"),")")].join(" ")})}}}catch(_){t=true;r=_}finally{try{if(!n&&null!=a.return)a.return()}finally{if(t)throw r}}var d=e["Depleted"]={};var f=true,m=false,p=void 0;try{for(var h=Object.values(e)[Symbol.iterator](),x;!(f=(x=h.next()).done);f=true){var g=x.value;var y=true,b=false,j=void 0;try{for(var k=Object.entries(g)[Symbol.iterator](),w;!(y=(w=k.next()).done);y=true){var C=(0,c.Z)(w.value,2),I=C[0],D=C[1];if(0===D.quantity){delete g[I];d[I]=D}}}catch(_){b=true;j=_}finally{try{if(!y&&null!=k.return)k.return()}finally{if(b)throw j}}}}catch(_){m=true;p=_}finally{try{if(!f&&null!=h.return)h.return()}finally{if(m)throw p}}return e}),[v,V]);var H,X,J;var Q=(0,k.useCallback)((function(e){return(0,z.h7)({centered:true,size:"lg",title:(null===e||void 0===e?void 0:e.category)?(0,d.jsx)(S.b,{category:e.category,categoryIcons:K}):(0,d.jsx)(f.x,{children:"Uncategorized"}),children:(0,d.jsx)(U.w,{data:{itemDefId:0,name:null!==(H=null===e||void 0===e?void 0:e.name)&&void 0!==H?H:"Undefined Item",description:null!==(X=null===e||void 0===e?void 0:e.description)&&void 0!==X?X:"",imageLink:null!==(J=null===e||void 0===e?void 0:e.imageLink)&&void 0!==J?J:null}})})}),[K]);var ee=(0,k.useCallback)((function(e,n){return(0,z.m6)({modal:P.t.ItemDefEditor,title:"Select Item Definition",centered:true,innerProps:{existingItemDef:e,availableItemDefs:E,categoryIcons:K,onSaveCallback:n}})}),[K,E]);var ne=(0,k.useMemo)((function(){return{headerLabel:"Item",order:2,viewComponent:function(e){var n;var t=e?null!==(n=null===V||void 0===V?void 0:V[e])&&void 0!==n?n:null:null;return(0,d.jsxs)(m.Z,{noWrap:true,position:"left",spacing:"0.25em",children:[t&&t.imageLink&&(0,d.jsx)(N.z,{imageLink:t.imageLink}),(0,d.jsx)(f.x,{children:null===t||void 0===t?void 0:t.name}),(0,d.jsx)(p.A,{ml:"auto",onClick:function(){return Q(t)},children:(0,d.jsx)(M.ON,{})})]})},editorComponent:function(e,n){var t=e?null===V||void 0===V?void 0:V[e]:void 0;var a;return(0,d.jsxs)(m.Z,{noWrap:true,position:"apart",children:[(0,d.jsx)(f.x,{children:null===t||void 0===t?void 0:t.name}),(0,d.jsx)(p.A,{onClick:function(){return ee(t,function(){var e=(0,r.Z)(s().mark((function _callee(e){return s().wrap((function _callee$(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return n(null!==(a=null===e||void 0===e?void 0:e.id)&&void 0!==a?a:null);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),_callee)})));return function(n){return e.apply(this,arguments)}}())},children:(0,d.jsx)(M.dY,{})})]})}}}),[Q,ee,V]);var te=B();var re=(0,j.Dd)(null!==n&&void 0!==n?n:null);var ae=(0,j.Dd)(null!==t&&void 0!==t?t:null);var ie=(0,k.useCallback)(function(){var e=(0,r.Z)(s().mark((function _callee(e,r){return s().wrap((function _callee$(a){while(1)switch(a.prev=a.next){case 0:if(!(!n||!t)){a.next=2;break}return a.abrupt("return");case 2:e.itemLogs=r.map((function(n){return{id:n.id>0?n.id:void 0,itemDefinition:e,itemDefinitionId:e.id,quantityChange:n.quantityChange,sourceNote:n.sourceNote,sourceUrl:n.sourceUrl,date:n.date}}));a.next=5;return t.save(e);case 5:a.t0=O;a.next=8;return t.find();case 8:a.t1=a.sent;a.t0.setState.call(a.t0,a.t1);a.t2=L;a.next=13;return n.find();case 13:a.t3=a.sent;a.t2.setState.call(a.t2,a.t3);case 15:case"end":return a.stop()}}),_callee)})));return function(n,t){return e.apply(this,arguments)}}(),[n,t,O,L]);var oe=(0,k.useCallback)((function(e){var n=e&&(null===V||void 0===V?void 0:V[e])||null;(0,z.m6)({modal:P.t.EditInventory,title:(0,d.jsx)(h.D,{children:n?"Edit Item":"Create Item"}),size:"xl",innerProps:{startingItemDef:n,itemDefNames:E.map((function(e){return e.name})),itemLogs:v,categories:G.filter((function(e){return"Depleted"!==e&&"Uncategorized"!==e})),categoryIconsPatterns:Y,categoryIcons:K,dataTableClasses:te.classes,onSaveCallback:ie}})}),[G,K,te.classes,ie,E,V,v]);var ce=(0,k.useCallback)(function(){var e=(0,r.Z)(s().mark((function _callee(e){return s().wrap((function _callee$(r){while(1)switch(r.prev=r.next){case 0:if(!(!n||!t)){r.next=2;break}return r.abrupt("return");case 2:L.filter((function(n){return n.itemDefinitionId!==e}));O.filter((function(n){return n.id!==e}));r.next=6;return(0,j.Wz)(n);case 6:r.next=8;return n.delete({itemDefinitionId:e});case 8:r.next=10;return(0,j.Wz)(t);case 10:r.next=12;return t.delete({id:e});case 12:case"end":return r.stop()}}),_callee)})));return function(n){return e.apply(this,arguments)}}(),[n,t]);var le=(0,k.useMemo)((function(){return null===G||null==F?(0,d.jsx)(f.x,{children:"Add items to get started"}):(0,d.jsx)(InventoryCurrent,{categories:G,categoryIcons:K,data:F,isEditMode:$,onEditClick:oe,onConfirmedDelete:ce},"items-inventory-current")}),[G,K,F,$,oe,ce]);var ue=(0,k.useMemo)((function(){return{isShopLog:false,rowObjToId:function(e){return e.id},propConfig:{quantityChange:(0,T.cL)("quantityChange","Change",1),itemDefinitionId:ne,date:(0,T.N4)("date","Date",200)},add:(0,r.Z)(s().mark((function _callee(){return s().wrap((function _callee$(e){while(1)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:e.next=4;return(0,j.Wz)(n);case 4:e.t0=L;e.next=7;return n.save(n.create());case 7:e.t1=e.sent;e.t0.append.call(e.t0,e.t1);case 9:case"end":return e.stop()}}),_callee)}))),edit:function(){var e=(0,r.Z)(s().mark((function _callee(e,n,t){var r;return s().wrap((function _callee$(i){while(1)switch(i.prev=i.next){case 0:r=v.findIndex((function(n){return n.id===e.id}));L.setItemProp(r,n,t);re(e,(0,a.Z)({},n,t));case 3:case"end":return i.stop()}}),_callee)})));return function(n,t,r){return e.apply(this,arguments)}}(),remove:function(){var e=(0,r.Z)(s().mark((function _callee(e){return s().wrap((function _callee$(t){while(1)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:L.filter((function(n){return n.id!==e.id}));t.next=5;return(0,j.Wz)(n);case 5:t.next=7;return null===n||void 0===n?void 0:n.remove(e);case 7:case"end":return t.stop()}}),_callee)})));return function(n){return e.apply(this,arguments)}}()}}),[ne,v,L,n,re]);var se=(0,k.useMemo)((function(){return{rowObjToId:function(e){return e.id},propConfig:{name:(0,T.Iw)("name","Name",0),category:(0,T.mm)("category","Category",1),imageLink:(0,T.Cm)("imageLink","Image",2),description:(0,T.Iw)("description","Description",3)},add:(0,r.Z)(s().mark((function _callee(){return s().wrap((function _callee$(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:e.next=4;return(0,j.Wz)(t);case 4:e.t0=O;e.next=7;return t.save(t.create());case 7:e.t1=e.sent;e.t0.append.call(e.t0,e.t1);case 9:case"end":return e.stop()}}),_callee)}))),edit:function(){var e=(0,r.Z)(s().mark((function _callee(e,n,t){var r;return s().wrap((function _callee$(i){while(1)switch(i.prev=i.next){case 0:r=E.findIndex((function(n){return n.id===e.id}));O.setItemProp(r,n,t);ae(e,(0,a.Z)({},n,t));case 3:case"end":return i.stop()}}),_callee)})));return function(n,t,r){return e.apply(this,arguments)}}(),remove:function(){var e=(0,r.Z)(s().mark((function _callee(e){var r;return s().wrap((function _callee$(a){while(1)switch(a.prev=a.next){case 0:if(!(!t||!n)){a.next=2;break}return a.abrupt("return");case 2:O.filter((function(n){return n.id!==e.id}));r=v.filter((function(n){return n.itemDefinitionId===e.id}));L.filter((function(e){return!r.some((function(n){return n.id===e.id}))}));a.next=7;return(0,j.Wz)(t);case 7:a.next=9;return t.remove(e);case 9:a.next=11;return(0,j.Wz)(n);case 11:a.next=13;return n.remove(r);case 13:case"end":return a.stop()}}),_callee)})));return function(n){return e.apply(this,arguments)}}()}}),[t,E,O,v,L,n,ae]);if(!n||!t)return(0,d.jsx)(h.D,{children:"LOADING..."});return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(x.K,{children:[(0,d.jsxs)(m.Z,{sx:{alignContent:"center"},children:[(0,d.jsx)(h.D,{order:2,sx:{width:"50%",textAlign:"right",marginRight:"auto"},children:"Items"}),(0,d.jsx)(D.wP,{checked:$,onToggle:R})]}),(0,d.jsxs)(m.Z,{position:"apart",children:[(0,d.jsx)(h.D,{order:3,children:"Inventory Summary"}),$&&(0,d.jsx)(g.z,{color:"green",leftIcon:(0,d.jsx)(M.dt,{}),onClick:function(){return oe(null)},children:"Add New Item"})]}),le,(0,d.jsx)(h.D,{order:3,children:"Inventory Log Details"}),(0,d.jsxs)(y.U,{variant:"separated",multiple:true,sx:function(e){return{".mantine-Accordion-panel":{margin:"0.5em",borderRadius:"0.5em",border:"1px solid "+e.colors.gray[7],backgroundColor:e.fn.darken(e.colors.gray[9],.2)},".mantine-Accordion-content":{borderRadius:"0.5em",overflow:"clip",padding:"2px"}}},children:[(0,d.jsxs)(y.U.Item,{value:"item-defs",children:[(0,d.jsx)(y.U.Control,{children:(0,d.jsx)(h.D,{order:4,children:"Item Definitions"})}),(0,d.jsx)(y.U.Panel,{children:(0,d.jsx)(b.x.Autosize,{maxHeight:"50vh",children:(0,d.jsx)(Z.w,(0,o.Z)((0,i.Z)({},se),{rowObjs:E,isEditMode:$,propsToMantineClasses:te.classes}),"items-log-editor")})})]}),(0,d.jsxs)(y.U.Item,{value:"item-log",children:[(0,d.jsx)(y.U.Control,{children:(0,d.jsx)(h.D,{order:4,children:"Item Log"})}),(0,d.jsx)(y.U.Panel,{children:(0,d.jsx)(b.x.Autosize,{maxHeight:"50vh",children:(0,d.jsx)(A.Q,(0,o.Z)((0,i.Z)({},ue),{rowObjs:v,isEditMode:$,propsToMantineClasses:te.classes}),"items-log-editor")})})]})]}),(0,d.jsx)(h.D,{order:3,children:"Output Preview"}),F&&(0,d.jsx)(InventoryBBCodeOutput,{data:F},"inv-bbcode-output")]})})};var R=ItemsPage}},function(e){var __webpack_exec__=function(n){return e(e.s=n)};e.O(0,[556,222,774,888,179],(function(){return __webpack_exec__(8473)}));var n=e.O();_N_E=n}]);